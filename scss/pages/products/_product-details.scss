@use "sass:map";
@use "../../core/variables" as *;
@use "../../core/mixins" as *;
/**
 * Kat UI Framework - 商品詳細ページ専用スタイル
 * 
 * ページ構造順にセクションを並べる:
 * 1) 商品ギャラリー 2) 商品情報 3) バリアント
 */

/* 1) 商品ギャラリー - 左カラム */
.kat-product-gallery {
  display: flex;
  align-items: flex-start;
  gap: $kat-space-4;

  /* メイン画像は正方形（1:1） */
  .kat-product-gallery__main {
    max-width: 675px;
    display: block;
    flex: 1;
    width: 100%;
    background-color: $kat-primary-50;
    overflow: hidden;
    aspect-ratio: 1 / 1;
    border-radius: $kat-radius-md;

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
  }

  /* ナビ付きサムネイル */
  .kat-product-gallery__thumbs-wrap {
    position: relative;
    margin-top: $kat-space-3;
  }
  .kat-product-gallery__thumbs {
    display: flex;
    gap: $kat-space-2;
    overflow: hidden;
    scroll-behavior: smooth;
  }
  .kat-product-gallery__thumb {
    flex: 0 0 auto;
    width: 4rem;
    height: 4rem;
    overflow: hidden;
    background: $kat-white;
    padding: 0;
    cursor: pointer;
    transition: all $kat-duration-200 $kat-ease-apple;

    &:hover {
      opacity: 1;
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    &.kat-product-gallery__thumb--active {
      opacity: 1;
      border: solid 2px $kat-primary-400;
    }
  }

  .kat-product-gallery__thumbs-btn {
    position: static;
    @include kat-btn-base;
    @include kat-btn-sm;
    width: $kat-icon-sm;
    border-radius: $kat-radius-full;

    &:hover { background-color: $kat-gray-100; transform: scale(1.05); }
    &:active { transform: scale(0.95); }

    &:disabled { @include kat-disabled; transform: none;
      &:hover { background-color: transparent; transform: none; }
    }

    svg { width: $kat-spinner-size; height: $kat-spinner-size; transition: transform $kat-duration-200 $kat-ease-apple; }

    &:hover svg { transform: scale(1.1); }
    border: $kat-component-border;
    background-color: rgba(255, 255, 255, 0.95);
    box-shadow: $kat-component-shadow-sm;
    color: $kat-primary-900;
    opacity: 0.9;
    backdrop-filter: blur(4px);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    
    svg {
      width: 1rem;
      height: 1rem;
    }
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }

  @include kat-screen-sm {
    .kat-product-gallery__thumb {
      width: 4rem;
      height: 4rem;
    }
    .kat-product-gallery__thumbs-btn { width: $kat-icon-sm; height: $kat-icon-sm; }
  }
  
  @include kat-screen-md {
    .kat-product-gallery__thumbs-vertical {
      max-height: 28rem;
    }
    
    .kat-product-gallery__thumbs-list {
      max-height: 24rem;
    }
  }
  
  @include kat-screen-lg {
    .kat-product-gallery__thumbs-vertical {
      max-height: 32rem;
    }
    
    .kat-product-gallery__thumbs-list {
      max-height: 28rem;
    }
  }

  .kat-product-gallery__thumbs-vertical {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: map.get($kat-spacing-map, 2);
    margin-right: $kat-space-4;
    order: -1;
    position: relative;
    height: 30rem;
    overflow: hidden;
  }

  .kat-product-gallery__thumbs-list {
    display: flex;
    flex-direction: column;
    gap: map.get($kat-spacing-map, 2);
    height: auto;
    overflow-y: auto;
    overflow-x: hidden;
    scroll-behavior: smooth;
    transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    scroll-snap-type: y proximity;
    scrollbar-width: none;
    -ms-overflow-style: none;

    &::-webkit-scrollbar {
      width: 0px;
      background: transparent;
      display: none;
    }

    // 高度なGPUアクセラレーション
    will-change: transform, scroll-position;
    backface-visibility: hidden;
    transform: translateZ(0);
    perspective: 1000px;

    // タッチデバイス向けの最適化
    -webkit-overflow-scrolling: touch;

    // スクロール中のスムーズな動き
    &.kat-gallery-scrolling {
      transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }
  }

  // スムーズスクロール用のキーフレームアニメーション
  @keyframes smoothGalleryScroll {
    0% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-2px);
    }
    100% {
      transform: translateY(0);
    }
  }
  
  /* サムネイルのデフォルト状態 */
  .kat-product-gallery__thumb {
    opacity: 1;
    pointer-events: auto;
    transition: opacity 0.3s ease;

    // スクロールスナップで自然な停止位置を確保
    scroll-snap-align: start;
    scroll-margin: map.get($kat-spacing-map, 1);
  }

  .kat-product-gallery__thumbs-vertical .kat-product-gallery__thumb {
    width: 4rem;
    height: 4rem;
    flex-shrink: 0;
    
    @media (min-width: 1024px) {
      width: 4rem;
      height: 4rem;
    }
  }
  
  .kat-product-gallery__thumbs-nav {
    display: flex;
    gap: map.get($kat-spacing-map, 2);
    margin-top: $kat-space-3;
    justify-content: center;
  }
}

/* 2) 商品情報 - 右カラムの上部 */
.kat-product-info {

  .kat-product-info__title {
    font-size: $kat-font-size-3xl;
    font-weight: $kat-font-weight-semibold;
    color: $kat-gray-900;
    margin-bottom: $kat-space-2;
  }
  .kat-product-info__subtitle {
    font-size: $kat-font-size-lg;
    color: $kat-gray-600;
    margin-bottom: $kat-space-2;
  }
  .kat-product-info__code {
    font-size: $kat-font-size-sm;
    color: $kat-gray-800;
    margin-bottom: $kat-space-4;
  }
  .kat-product-info__rating {
    display: flex;
    align-items: center;
    gap: $kat-space-3;
    margin-bottom: $kat-space-4;
    .kat-stars {
      color: $kat-warning-400;
      font-size: $kat-font-size-lg;
    }
    .kat-rating-text {
      font-size: $kat-font-size-sm;
      color: $kat-gray-600;
    }
  }
  .kat-product-info__favorite {
    @include kat-btn-base;
    width: $kat-icon-size;
    height: $kat-icon-size;
    margin-left: auto;
    border-radius: $kat-radius-full;
    border: $kat-component-border;
    background-color: $kat-white;
    color: $kat-warning-400;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    &:hover { background-color: $kat-warning-50; border-color: map.get(map.get($kat-semantic-colors, warning), 500); }
  }
  .kat-product-info__price {
    margin-bottom: $kat-space-4;
    .kat-product-info__price-main {
      font-size: $kat-font-size-3xl;
      font-weight: $kat-font-weight-bold;
      color: $kat-gray-900;
    }
  }
  .kat-product-info__shipping {
    font-size: $kat-font-size-sm;
    color: $kat-gray-600;
    margin-bottom: $kat-space-4;
    padding: $kat-space-3;
    background-color: $kat-gray-50;
    border-radius: $kat-radius-md;
  }
}

/* 3) 商品バリアント - 右カラムの下部（サイズ/カラーなど） */
.kat-product-variants {
  margin-bottom: $kat-space-6;
}
.kat-product-variants__group {
  margin-bottom: $kat-space-4;
}
.kat-product-variants__label {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: $kat-space-3;
  font-size: $kat-font-size-sm;
  font-weight: $kat-font-weight-semibold;
  color: $kat-gray-900;
}
.kat-product-variants__options {
  display: flex;
  gap: $kat-space-2;
  flex-wrap: wrap;
}

/* カラースウォッチとサイズ表リンク */
.kat-product-variants__color-swatch { @include kat-swatch($kat-icon-sm); }
.kat-product-variants__size-chart {
  font-size: $kat-font-size-sm;
  color: $kat-primary-600;
  text-decoration: underline;
  margin-left: $kat-space-3;
  &:hover {
    color: $kat-primary-800;
  }
}

/* 4) 数量とアクション - 右カラムの購入操作領域 */
.kat-product-actions {
  display: flex;
  flex-direction: column;
  gap: $kat-space-5;
  margin: $kat-space-6 0;
}

.kat-quantity-selector {
  .kat-quantity-selector__label {
    display: block;
    font-weight: $kat-font-weight-semibold;
    color: $kat-gray-900;
    margin-bottom: $kat-space-2;
  }
  
  .kat-quantity-selector__controls { @include kat-quantity-controls; }
  .kat-quantity-selector__input { @include kat-quantity-input; }
}

.kat-product-actions__buttons {
  display: grid;
  grid-template-columns: 1fr;
  gap: $kat-space-3;
}

/* 5) 情報補足 - 在庫/配送/返品などの情報 */
.kat-product-meta {
  margin-top: $kat-space-6;
  padding-top: $kat-space-4;
  border-top: $kat-border-1 solid $kat-gray-200;
  display: grid;
  gap: $kat-space-2;
}

.kat-product-meta__item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.kat-product-meta__label {
  font-weight: $kat-font-weight-semibold;
  color: $kat-gray-800;
}

.kat-product-meta__value {
  color: $kat-gray-700;
}

/* 6) タブコンテンツ - 商品説明、仕様、配送情報 */
.kat-product-description {
  h3 {
    font-size: $kat-font-size-2xl;
    font-weight: $kat-font-weight-semibold;
    color: $kat-gray-900;
    margin-bottom: $kat-space-4;
  }
  
  h4 {
    font-size: $kat-font-size-xl;
    font-weight: $kat-font-weight-semibold;
    color: $kat-gray-800;
    margin: $kat-space-6 0 $kat-space-3 0;
  }
  
  p {
    font-size: $kat-font-size-base;
    line-height: $kat-line-height-relaxed;
    color: $kat-gray-700;
    margin-bottom: $kat-space-4;
  }
  
  ul {
    margin: $kat-space-3 0 $kat-space-4 0;
    padding-left: $kat-space-6;
    
    li {
      font-size: $kat-font-size-base;
      line-height: $kat-line-height-relaxed;
      color: $kat-gray-700;
      margin-bottom: $kat-space-2;
      
      strong {
        font-weight: $kat-font-weight-semibold;
        color: $kat-gray-900;
      }
    }
  }
}

.kat-product-specs {
  h3 {
    font-size: $kat-font-size-2xl;
    font-weight: $kat-font-weight-semibold;
    color: $kat-gray-900;
    margin-bottom: $kat-space-4;
  }
  
  h4 {
    font-size: $kat-font-size-xl;
    font-weight: $kat-font-weight-semibold;
    color: $kat-gray-800;
    margin: $kat-space-6 0 $kat-space-3 0;
  }
}

.kat-product-shipping {
  h3 {
    font-size: $kat-font-size-2xl;
    font-weight: $kat-font-weight-semibold;
    color: $kat-gray-900;
    margin-bottom: $kat-space-4;
  }
  
  p {
    font-size: $kat-font-size-base;
    line-height: $kat-line-height-relaxed;
    color: $kat-gray-700;
    margin-bottom: $kat-space-4;
  }
}
